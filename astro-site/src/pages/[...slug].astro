---
import Layout from "../layouts/Layout.astro";
import BlockRenderer, { type Block } from "../components/BlockRenderer.astro";
import { fetchPage } from "../lib/fetch-strapi";

const { slug } = Astro.params;

if (!slug) {
  throw new Error("Slug is required");
}

const page = await fetchPage(slug);

// TODO make seo a single object and not an array
const seo = page.seo?.[0];

if (!page) {
  throw new Error("Page not found");
}
---

<Layout
  title={seo?.metaTitle}
  description={seo?.metaDescription}
  seoImageUrl={seo?.shareImage?.url}
>
  <BlockRenderer blocks={page.blocks as Block[]} />
</Layout>
